<!DOCTYPE html>
<html>
<head>
<title> Hi Beanch 1 </title>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

var availableDate = [];
var dataString;

window.onscroll = function() {    
    myNavFunction();
};

function myNavFunction() {
  var navbar = document.getElementById("navbar");
var sticky = navbar.offsetTop;
  if (window.pageYOffset >= 56 && jQuery(window).width() < 992 ) {
    navbar.classList.add("sticky");        
  }
  else if (window.pageYOffset >= 72.6 && jQuery(window).width() >= 992 ) {
    navbar.classList.add("sticky");
  } else {
    navbar.classList.remove("sticky");
  }
}

jQuery(document).ready(function(){
    showData();
});

setInterval(function(){ 
    showData();
}, 30000);

function showData(){
    
    var html = "";
    var date;
    var text  = [];
    var options; 
    var old = [];

  jQuery.each(dataString, function() {
      if( date == this[5] ){
      
          if( $.inArray( this[7] , text ) == -1 ){
              text.push(this[7]);
          }
      
          if( this[1] == 0 ){
              var dd = this[5]+" "+this[6]+"+"+this[4];
              html += "<div class='col-md-2 col-sm-12 col-xs-12 bgGreen slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='form-div'><form><input placeholder='Comment...' type='text' name='com' class='form-control'><input type='hidden' name='x_email' value='paw.harpiks@gmail.com'><input type='hidden' name='tid' value='"+dd+"'></form><button data-dateid='"+this[4]+"' data-time='"+this[6]+"' data-date='"+this[5]+"' data-url='//test.pawersystems.dk/psa/useradmin.usertid_ajax' class='btn btn-default' onclick='bookTicket(this)'>Book</button></div></div>";
          }
          else
              html += "<div class='col-md-2 col-sm-12 col-xs-12 bgSilver slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='btn-div'><button class='btn btn-default' data-url='/psa/useradmin.usercancel_booking_ajax?num="+this[3]+"' data-id='"+this[3]+"' onclick='cancelBooking(this)'> Cancel</button></div></div>";

      }else{
          availableDate.push(this[5]);
          date = this[5];
          html += "<div class='col-md-12 col-sm-12 col-xs-12 bgGray "+date+" '><h3>"+date+" - "+this[0]+"</h3></div>";
          if( $.inArray( this[7] , text ) == -1 ){
              text.push(this[7]);
          }
      
          if( this[1] == 0 ){
              var dd = this[5]+" "+this[6]+"+"+this[4];
              html += "<div class='col-md-2 col-sm-12 col-xs-12 bgGreen slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='form-div'><form><input placeholder='Comment...' type='text' name='com' class='form-control'><input type='hidden' name='x_email' value='paw.harpiks@gmail.com'><input type='hidden' name='tid' value='"+dd+"'></form><button data-dateid='"+this[4]+"' data-time='"+this[6]+"' data-date='"+this[5]+"' data-url='//test.pawersystems.dk/psa/useradmin.usertid_ajax' class='btn btn-default' onclick='bookTicket(this)'>Book</button></div></div>";
          }
          else
              html += "<div class='col-md-2 col-sm-12 col-xs-12 bgSilver slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='btn-div'><button class='btn btn-default' data-url='/psa/useradmin.usercancel_booking_ajax?num="+this[3]+"' data-id='"+this[3]+"' onclick='cancelBooking(this)'> Cancel</button></div></div>";

      }
  });
    jQuery(".avaData").html(html);

    var optionArray = text.filter(function(v){return v!==""});
    options += "<option>-- Saearch By Text --</option>";
    jQuery.each(optionArray, function() {
      options += "<option>"+this+"</option>";
    });

// Add new function here
    jQuery(".avaData").html(html);

    var optionArray = text.filter(function(v){return v!==""});
    options += "<option>-- Saearch By Text --</option>";
    jQuery.each(optionArray, function() {
      options += "<option>"+this+"</option>";
    });
// end new function here

    jQuery(".text_search").html(options);
    
    if( jQuery("body").width() > 768 ){
        var maxHeight = Math.max.apply(null, $(".slot").map(function ()
        {
          return $(this).height();
        }).get());
        jQuery(".slot").css("height",maxHeight);
        jQuery(".form-div").css("position","absolute");
    }
  
    //jQuery( "#datepicker" ).datepicker({ 
  //   dateFormat: "dd-mm-yy", firstDay: 1, 
  //   beforeShowDay: available 
  // });   
  // jQuery( "#datepicker" ).val(""); 

  //   $.ajax({
  //   type: "POST",
  //   url: "https://test.pawersystems.dk/ps/free_and_booked_spots?mailid=paw.harpiks@gmail.com",
  //   success: function(response){
  //       dataString = $.parseJSON(response);
  //       if( !equalArray(old,dataString) )
  //       {
  //           jQuery.each(dataString, function() {
  //               if( date == this[5] ){
                
  //                   if( $.inArray( this[7] , text ) == -1 ){
  //                       text.push(this[7]);
  //                   }
                
  //                   if( this[1] == 0 ){
  //                       var dd = this[5]+" "+this[6]+"+"+this[4];
  //                       html += "<div class='col-md-2 col-sm-12 col-xs-12 bgGreen slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='form-div'><form><input placeholder='Comment...' type='text' name='com' class='form-control'><input type='hidden' name='x_email' value='paw.harpiks@gmail.com'><input type='hidden' name='tid' value='"+dd+"'></form><button data-dateid='"+this[4]+"' data-time='"+this[6]+"' data-date='"+this[5]+"' data-url='//test.pawersystems.dk/psa/useradmin.usertid_ajax' class='btn btn-default' onclick='bookTicket(this)'>Book</button></div></div>";
  //                   }
  //                   else
  //                       html += "<div class='col-md-2 col-sm-12 col-xs-12 bgSilver slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='btn-div'><button class='btn btn-default' data-url='/psa/useradmin.usercancel_booking_ajax?num="+this[3]+"' data-id='"+this[3]+"' onclick='cancelBooking(this)'> Cancel</button></div></div>";

  //               }else{
  //                   availableDate.push(this[5]);
  //                   date = this[5];
  //                   html += "<div class='col-md-12 col-sm-12 col-xs-12 bgGray "+date+" '><h3>"+date+" - "+this[0]+"</h3></div>";
  //                   if( $.inArray( this[7] , text ) == -1 ){
  //                       text.push(this[7]);
  //                   }
                
  //                   if( this[1] == 0 ){
  //                       var dd = this[5]+" "+this[6]+"+"+this[4];
  //                       html += "<div class='col-md-2 col-sm-12 col-xs-12 bgGreen slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='form-div'><form><input placeholder='Comment...' type='text' name='com' class='form-control'><input type='hidden' name='x_email' value='paw.harpiks@gmail.com'><input type='hidden' name='tid' value='"+dd+"'></form><button data-dateid='"+this[4]+"' data-time='"+this[6]+"' data-date='"+this[5]+"' data-url='//test.pawersystems.dk/psa/useradmin.usertid_ajax' class='btn btn-default' onclick='bookTicket(this)'>Book</button></div></div>";
  //                   }
  //                   else
  //                       html += "<div class='col-md-2 col-sm-12 col-xs-12 bgSilver slot "+this[5]+" '><p class='SlotClr'>"+this[2]+"</p><p>"+this[0]+"<br>"+this[5]+"<br>"+this[6]+"<br>"+this[7]+"</p><div class='btn-div'><button class='btn btn-default' data-url='/psa/useradmin.usercancel_booking_ajax?num="+this[3]+"' data-id='"+this[3]+"' onclick='cancelBooking(this)'> Cancel</button></div></div>";

  //               }
  //           });
  //             jQuery(".avaData").html(html);
      
  //             var optionArray = text.filter(function(v){return v!==""});
  //             options += "<option>-- Saearch By Text --</option>";
  //             jQuery.each(optionArray, function() {
  //               options += "<option>"+this+"</option>";
  //             });

  //             jQuery(".text_search").html(options);
              
  //             if( jQuery("body").width() > 768 ){
  //                 var maxHeight = Math.max.apply(null, $(".slot").map(function ()
  //                 {
  //                   return $(this).height();
  //                 }).get());
  //                 jQuery(".slot").css("height",maxHeight);
  //                 jQuery(".form-div").css("position","absolute");
  //             }
  //           $( "#datepicker" ).datepicker({ 
  //             dateFormat: "dd-mm-yy", firstDay: 1, 
  //             beforeShowDay: available 
  //           });   
  //           $( "#datepicker" ).val(""); 
  //       }
  //       else{
  //           console.log("Not Updated");
  //       }
     
  //   }
  // });

}

// function equalArray(a, b) {
//     return JSON.stringify(a) == JSON.stringify(b);
// }

// function cancelBooking(obj){
    
//     var url = jQuery(obj).attr("data-url");
//      jQuery.ajax({url: url ,success: function(result){
//             if( result.includes("<!DOCTYPE") )
//                 location.reload();
//             var data = JSON.parse(result); 
//             if(data.check == 1){
//                 var html = '<div class="flashMessage" style=" position: fixed; background: LimeGreen; color: white; width: 100%; text-align: center; padding: 10px; z-index: 10; ">'+data.message+'</div>';
//                 jQuery("body").prepend(html);
//                 setTimeout(function() {
//                     $(".flashMessage").remove();
//                 }, 3000); 
                
//                 //================== Change HTML ===============
//                 jQuery(obj).parent().parent().removeClass("bgSilver").addClass("bgGreen");
//                 jQuery(obj).parent().parent().find(".SlotClr").text(data.status);
//                 var dd = data.date+" "+data.time+"+"+data.dateid;
//                 jQuery(obj).parent().parent().append("<div class='form-div'><form><input placeholder='Comment...' type='text' name='com' class='form-control'><input type='hidden' name='x_email' value='paw.harpiks@gmail.com'><input type='hidden' name='tid' value='"+dd+"'></form><button data-dateid='"+this[4]+"' data-time='"+this[6]+"' data-date='"+this[5]+"' data-url='//test.pawersystems.dk/psa/useradmin.usertid_ajax' class='btn btn-default' onclick='bookTicket(this)'>Book</button></div>");
//                 jQuery(obj).parent().remove();
//                 if( jQuery(window).width() > 768 )
//                     jQuery(".form-div").css("position","absolute");
//             } 
//             else{
//                 var html = '<div class="flashMessage" style=" position: fixed; background: red; color: white; width: 100%; text-align: center; padding: 10px; z-index: 10; ">'+data.message+'</div>';
//                 jQuery("body").prepend(html);
//                 setTimeout(function() {
//                     $(".flashMessage").remove();
//                 }, 3000);   
//             }
            
//         },
//         error: function() { 
//             location.reload();
//         } 
//     });  

// }


// function bookTicket(obj){
//     var url = jQuery(obj).attr("data-url");
//     var form = jQuery(obj).parent().find("form");
    
//     jQuery.ajax({url: url , data: jQuery(form).serialize() ,success: function(result){
//         if( result.includes("<!DOCTYPE") )
//             location.reload();
//         var data = JSON.parse(result); 
//         if(data.check == 1){
//             var html = '<div class="flashMessage" style=" position: fixed; background: LimeGreen; color: white; width: 100%; text-align: center; padding: 10px; z-index: 10; ">'+data.message+'</div>';
//             jQuery("body").prepend(html);
//             setTimeout(function() {
//                 $(".flashMessage").remove();
//             }, 3000); 
            
//             //================== Change HTML ===============
//             jQuery(obj).parent().parent().removeClass("bgGreen").addClass("bgSilver");
//             jQuery(obj).parent().parent().find(".SlotClr").text(data.status);
//             jQuery(obj).parent().parent().append("<div class='btn-div'><button class='btn btn-default' data-url='/psa/useradmin.usercancel_booking_ajax?num="+data.id+"' onclick='cancelBooking(this)'> Cancel</button></div>");
//             jQuery(obj).parent().remove();
//         } 
//         else{
//             var html = '<div class="flashMessage" style=" position: fixed; background: red; color: white; width: 100%; text-align: center; padding: 10px; z-index: 10; ">'+data.message+'</div>';
//             jQuery("body").prepend(html);
//             setTimeout(function() {
//                 $(".flashMessage").remove();
//             }, 3000);   
//         }
        
//     },
//     error: function() { 
//         location.reload();
//     } 
//     });  
// }


function available(date) {

  var availableDates = [];
  $.each(availableDate, function(index, value){
      availableDates.push(value);
    });

var dd = date.getDate();
var mm = date.getMonth()+1; 
var yyyy = date.getFullYear();
if(dd<10) { dd="0"+dd; } 
if(mm<10) { mm="0"+mm;} 

  dmy = dd + "-" + mm + "-" + yyyy;
  if ($.inArray(dmy, availableDates) != -1) {
    return [true, "","Available"];
  } else {
    return [false,"","unAvailable"];
  }
}

function getDate(obj){
  jQuery(".text_search").val(jQuery(".text_search option:first").val());
  var date = jQuery(obj).val();
  jQuery('.bgGray').hide();
  jQuery('.slot').hide().removeClass("active");
  jQuery('.'+date).fadeIn().addClass("active");
}

function searchByText(obj){
  jQuery("#datepicker").val("");
  var text = jQuery(obj).find('option:selected').text();
  jQuery(".slot").hide().removeClass("active");
  jQuery(".bgGray").hide();
  jQuery(".slot:contains('"+text+"')").fadeIn().addClass("active");
  jQuery('.bgGray').each(function(){
    if(jQuery(this).nextUntil(".bgGray").hasClass('active'))
      jQuery(this).fadeIn();
  });

}


</script> 
<style>

  .btn-default{ background:white; }
  .avaData{
    display: flow-root;
    text-align:center;
  }
  .text-style{
    color: white;
    text-decoration: none;
  }
  .text-style:hover{
    color: white;
  }
  .bgGreen{
    background: #71bf44;
    border: 1px solid white;
    border-radius: 15px;
    padding:0px;
  }
  .bgSilver{
    background: silver;
    border: 1px solid white;
    border-radius: 15px;
    padding:0px;
  }
  .bgGray{
    background: gray;
    border: 1px solid white;
    padding: 10px 0;
    position: -webkit-sticky;
    position: sticky;
    z-index: 1;
  }
  .bgGray h3{ font-size:20px; }
  .SlotClr{
    color:white;
    background:gray;
  }
  .form-div{
    margin:5px;
    bottom: 0;
    padding-bottom:10px;
    width: -webkit-fill-available;
  }
  .slot button{
    background:gray;
    color:white;
    margin-top:5px;
  }
  .btn-div{
    margin-bottom: 15px;
   }   
@media only screen and (min-width:768px){  
  .btn-div{
    position: absolute;
    bottom: 0;
    left: 25%;
    width:50%;
  }
}

@media only screen and (max-width: 768px){
  #navbar div{
    margin-bottom: 5px;
  }
  .bgGray{ top:134px; }
}

@media only screen and (min-width: 769px){
  .bgGray{ top:54px; }
}





#navbar {
  z-index: 9;
  overflow: hidden;
  background-color: #343a40;
  padding: 10px;
}

#navbar a {
  float: left;
  display: block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

#navbar a:hover {
  background-color: #ddd;
  color: black;
}

#navbar a.active {
  background-color: #4CAF50;
  color: white;
}

.content {
  padding: 16px;
}

.sticky {
  position: sticky;
  top: 0;
  width: 100%;
}

.sticky + .content {
  padding-top: 60px;
}


</style>
</head>
<body>

<div id="navbar">
  <div class="col-md-5 col-sm-12 col-xs-12">
    <input type="text" placeholder="Search By Date" class="form-control" id="datepicker" onchange="getDate(this)" autocomplete="off">
  </div>
  <div class="col-md-5 col-sm-12 col-xs-12">
    <select class="form-control text_search" onchange="searchByText(this)">
      <option>-- Search By Text --</option>
    </select>
  </div>

</div>

<div class="avaData"></div>




</body>
</html>
